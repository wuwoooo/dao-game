# 游戏/应用分发平台产品需求文档

## 1. 平台前端需求

- 平台前端通过 H5 页面形式接入第三方平台，用户访问时需携带 `token` 参数以进行身份识别和权限校验。
- 平台推广的所有游戏均为 HTML5 游戏，可通过 `iframe` 或嵌入式方式集成到第三方页面；所分发的非游戏应用以外部链接形式跳转到对应页面。
- 前端需在页面加载和用户操作时上报数据，包括广告展示（impression）和有效点击（点击后完成跳转或指定行为）等，用于后端进行 CPA/CPM 计费和统计分析。
- 根据业务需要，前端可调用后端“用户信息接口”验证 `token` 并获取用户基础信息（如用户 ID、昵称、头像等），以便对不同用户进行个性化展示和行为跟踪。

## 2. 平台后端需求

- **第三方游戏/应用所有者功能**：用户（游戏/应用所有者）可以在平台后台注册并登录账号，提交游戏/应用上架申请；审核通过后，其应用即可上架分发。所有者可以在后台设置推广预算与投放位置（如选择首页推荐位、分类页广告位等），并查看推广数据报表（展示次数、点击次数、消耗 SKY 代币等）。
- 所有者需要使用平台代币 SKY（区块链代币）进行充值与支付。平台后端提供充值接口并保存充值记录，当账户余额不足时自动暂停该应用/游戏的展示和推广，直至账户充值完成。
- **后台管理端** 支持三种角色：
  - **审核管理员**：负责管理上架流程，可审核或驳回第三方提交的游戏/应用上架申请。
  - **运维人员**：负责维护推广位和营销活动，可配置推广位位置、预算规则和进行数据监控。
  - **超级管理员**：拥有全局权限，可管理所有角色、权限设置以及系统配置，确保平台正常运行。

## 3. 后台服务 API 模块

- 详见 api.md

## 4. 推广与计费需求

推广和计费方面，平台提供完善的推广工具和灵活的计费策略：

- **推广工具**：允许所有者选择广告投放位置（如首页轮播、分类页侧边栏等）并设置推广预算（总预算与每日预算）。平台提供数据分析面板，展示投放效果数据（曝光量、点击量、转化量等）以及费用消耗明细，帮助优化投放效果。
- **计费模型**：采用 CPA（每次有效点击付费）和 CPM（每千次展示付费）两种模式。在 CPA 模式下，只有当用户产生一次有效行为（例如点击广告并成功跳转）时才计费；在 CPM 模式下，每播放 1000 次广告展示即扣除相应的费用。系统支持设置计费上限，如对每个目标用户每天最多计费两次，以控制成本支出。

## 5. 数据库结构设计

### Owner (应用所有者表)

| 字段       | 类型     | 描述                 |
| ---------- | -------- | -------------------- |
| id         | INT      | 主键，所有者 ID      |
| name       | VARCHAR  | 所有者名称           |
| email      | VARCHAR  | 注册邮箱（登录账号） |
| password   | VARCHAR  | 登录密码（加密存储） |
| balance    | DECIMAL  | SKY 代币当前余额     |
| created_at | DATETIME | 注册时间             |

### GameApp (游戏/应用表)

| 字段       | 类型     | 描述                                  |
| ---------- | -------- | ------------------------------------- |
| id         | INT      | 主键，游戏/应用 ID                    |
| owner_id   | INT      | 所有者 ID (外键，关联 Owner 表)       |
| name       | VARCHAR  | 应用名称                              |
| type       | VARCHAR  | 类型（Game/应用）                     |
| url        | VARCHAR  | 页面地址（H5 游戏链接或外链 URL）     |
| status     | VARCHAR  | 上架状态（Pending/Approved/Rejected） |
| created_at | DATETIME | 提交申请时间                          |

### Budget (推广预算表)

| 字段         | 类型    | 描述                            |
| ------------ | ------- | ------------------------------- |
| id           | INT     | 主键，预算记录 ID               |
| owner_id     | INT     | 所有者 ID (外键)                |
| gameapp_id   | INT     | 游戏/应用 ID (外键)             |
| daily_budget | DECIMAL | 每日预算 (SKY)                  |
| total_budget | DECIMAL | 总预算 (SKY)                    |
| placements   | VARCHAR | 投放位置标识 (如首页、分类页等) |
| start_date   | DATE    | 推广开始日期                    |
| end_date     | DATE    | 推广结束日期                    |

### RechargeRecord (充值记录表)

| 字段      | 类型     | 描述              |
| --------- | -------- | ----------------- |
| id        | INT      | 主键，充值记录 ID |
| owner_id  | INT      | 所有者 ID (外键)  |
| amount    | DECIMAL  | 充值金额 (SKY)    |
| timestamp | DATETIME | 充值时间          |

### ConsumptionRecord (消耗记录表)

| 字段       | 类型    | 描述                                |
| ---------- | ------- | ----------------------------------- |
| id         | INT     | 主键，消耗记录 ID                   |
| owner_id   | INT     | 所有者 ID (外键)                    |
| gameapp_id | INT     | 游戏/应用 ID (外键)                 |
| cost_type  | VARCHAR | 消费类型 (CPA 或 CPM)               |
| amount     | DECIMAL | 消耗 SKY 代币数量                   |
| count      | INT     | 计费次数（点击次数或展示次数/1000） |
| date       | DATE    | 消耗日期                            |

### Roles, Permissions, RolePermission

- Roles 表字段：`id`, `name`（如“审核管理员”、“运维人员”等）
- Permissions 表字段：`id`, `name`（如“游戏审核”、“预算设置”等）
- RolePermission 表字段：`role_id`, `permission_id`，定义权限关联

## 6. 接口定义

- 详见 api.md

## 7. 权限控制矩阵

| 功能模块       | 审核管理员 | 运维人员 | 超级管理员 |
| -------------- | ---------- | -------- | ---------- |
| 游戏/应用审核  | ✓          |          | ✓          |
| 推广位管理     |            | ✓        | ✓          |
| 预算设置与管理 |            | ✓        | ✓          |
| 数据统计分析   | ✓          | ✓        | ✓          |
| 系统配置运维   |            |          | ✓          |
| 角色权限管理   |            |          | ✓          |
